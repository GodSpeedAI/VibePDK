
#!/usr/bin/env bash
# shell=bash
# direnv configuration for Cookiecutter template repo
# This file is intended to support contributors working on the template and test-driving the generated project locally.
# Keep secrets out of source control. Prefer .envrc.local (git-ignored) for sensitive overrides.

# --- Runtime versions (requires asdf/pyenv/nodenv/nvm integration with direnv) ---
# Use direnv to automatically load Python and Node
use python 3.11
use node 18

# --- Project directory detection ---
# Prefer the templated folder when present; otherwise, assume a rendered project layout.
if [ -d "$PWD/{{cookiecutter.project_slug}}" ]; then
  export PROJECT_DIR="$PWD/{{cookiecutter.project_slug}}"
else
  export PROJECT_DIR="$PWD"
fi

# --- Core markers ---
export TEMPLATE_REPO=1
export PROJECT_SLUG=${PROJECT_SLUG:=my-hexagon-app}
export PYTHON_VERSION=${PYTHON_VERSION:=3.11}

# --- Core project settings ---
export DOMAIN_FILE="${DOMAIN_FILE:=$PROJECT_DIR/domain/domain.yaml}"
export CALM_FILE="${CALM_FILE:=$PROJECT_DIR/architecture/calm/system.calm.json}"
export CALM_PATTERNS_DIR="${CALM_PATTERNS_DIR:=$PROJECT_DIR/architecture/calm/patterns}"
export DOCKER_REGISTRY="${DOCKER_REGISTRY:=ghcr.io/my-org}"

# Optional: project description and author (used by hooks)
export PROJECT_NAME="${PROJECT_NAME:=my-project}"
export PROJECT_DESCRIPTION="${PROJECT_DESCRIPTION:=My Nx + CALM + Cookiecutter monorepo}"

# --- Nx settings ---
export NX_CLOUD_ACCESS_TOKEN="${NX_CLOUD_ACCESS_TOKEN:=}"
export NX_CACHE_ENABLED="${NX_CACHE_ENABLED:=true}"
export NX_DAEMON="${NX_DAEMON:=false}"

# --- Application environment ---
export APP_ENV="${APP_ENV:=development}"
export DATABASE_URL="${DATABASE_URL:=postgresql://user:password@localhost:5432/mydb}"
export REDIS_URL="${REDIS_URL:=redis://localhost:6379/0}"
export SECRET_KEY="${SECRET_KEY:=replace_with_a_real_secret}"

# --- Thirdâ€‘party tokens (leave blank or load securely) ---
export GITHUB_MCP_TOKEN="${GITHUB_MCP_TOKEN:=}"
export OPENAI_API_KEY="${OPENAI_API_KEY:=}"

# --- Paths and performance knobs ---
# Add translator tools to PATH when present
if [ -d "$PROJECT_DIR/tools/transformers" ]; then
  export PATH="$PROJECT_DIR/tools/transformers:$PATH"
fi
# Token/performance limits for prompt tasks (if used)
export PROMPT_TOKENS_WARN=${PROMPT_TOKENS_WARN:=12000}
export PROMPT_TOKENS_HARD=${PROMPT_TOKENS_HARD:=16000}

# --- Locale and reproducibility ---
export LC_ALL=C.UTF-8
export LANG=C.UTF-8
export TZ="${TZ:=UTC}"
export PYTHONUTF8="${PYTHONUTF8:=1}"

# --- direnv stdlib niceties ---
layout dotenv .env 2>/dev/null || true

# --- Local overrides (ignored by git) ---
if [ -f .envrc.local ]; then
  source_env .envrc.local
fi
